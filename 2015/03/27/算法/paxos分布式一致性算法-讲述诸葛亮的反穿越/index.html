<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/fancybox/3.3.5/jquery.fancybox.min.css">
  <link rel="stylesheet" href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-flash.min.css">
  <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"www.taohui.pub","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"default"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":true,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":false,"nav":null,"activeClass":"gitalk"},"algolia":{"hits":{"per_page":6},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":5,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="引子一日，诸葛亮找到刘备，突然献上一曲《独角戏》，而后放声大哭。刘备正沉醉于新曲，暗叹孔明大才，竟作得如此不凡仙乐，看到孔明忽而大悲，慌问：“水，何事悲恸？”">
<meta property="og:type" content="article">
<meta property="og:title" content="paxos分布式一致性算法--讲述诸葛亮的反穿越">
<meta property="og:url" content="https://www.taohui.pub/2015/03/27/%E7%AE%97%E6%B3%95/paxos%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%80%E8%87%B4%E6%80%A7%E7%AE%97%E6%B3%95-%E8%AE%B2%E8%BF%B0%E8%AF%B8%E8%91%9B%E4%BA%AE%E7%9A%84%E5%8F%8D%E7%A9%BF%E8%B6%8A/index.html">
<meta property="og:site_name" content="个人笔记">
<meta property="og:description" content="引子一日，诸葛亮找到刘备，突然献上一曲《独角戏》，而后放声大哭。刘备正沉醉于新曲，暗叹孔明大才，竟作得如此不凡仙乐，看到孔明忽而大悲，慌问：“水，何事悲恸？”">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2015-03-27T08:33:24.000Z">
<meta property="article:modified_time" content="2022-06-22T03:17:59.892Z">
<meta property="article:author" content="陶辉">
<meta property="article:tag" content="paxos">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://www.taohui.pub/2015/03/27/%E7%AE%97%E6%B3%95/paxos%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%80%E8%87%B4%E6%80%A7%E7%AE%97%E6%B3%95-%E8%AE%B2%E8%BF%B0%E8%AF%B8%E8%91%9B%E4%BA%AE%E7%9A%84%E5%8F%8D%E7%A9%BF%E8%B6%8A/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>paxos分布式一致性算法--讲述诸葛亮的反穿越 | 个人笔记</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">个人笔记</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">陶辉的技术分享</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-关于陶辉">

    <a href="/%E5%85%B3%E4%BA%8E%E9%99%B6%E8%BE%89" rel="section"><i class="fa fa-user fa-fw"></i>关于陶辉</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.taohui.pub/2015/03/27/%E7%AE%97%E6%B3%95/paxos%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%80%E8%87%B4%E6%80%A7%E7%AE%97%E6%B3%95-%E8%AE%B2%E8%BF%B0%E8%AF%B8%E8%91%9B%E4%BA%AE%E7%9A%84%E5%8F%8D%E7%A9%BF%E8%B6%8A/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/taohui_avatar.JPG">
      <meta itemprop="name" content="陶辉">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="个人笔记">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          paxos分布式一致性算法--讲述诸葛亮的反穿越
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2015-03-27 16:33:24" itemprop="dateCreated datePublished" datetime="2015-03-27T16:33:24+08:00">2015-03-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-06-22 11:17:59" itemprop="dateModified" datetime="2022-06-22T11:17:59+08:00">2022-06-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%AE%97%E6%B3%95/" itemprop="url" rel="index"><span itemprop="name">算法</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>5.4k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>5 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="引子"><a href="#引子" class="headerlink" title="引子"></a>引子</h1><p>一日，诸葛亮找到刘备，突然献上一曲《独角戏》，而后放声大哭。刘备正沉醉于新曲，暗叹孔明大才，竟作得如此不凡仙乐，看到孔明忽而大悲，慌问：“水，何事悲恸？” </p>
<span id="more"></span>
<p>诸葛亮止住抽泣：“亮自主公三顾茅庐出山以来，蒙主公厚爱，自比如鱼得水，敢不尽力？然每日击鼓升帐，皆亮一人在上唱独角戏，众将在下唯唯诺诺，只是照亮的安排做事。如此下去，亮日后定会被司马懿那厮累死呀。”<br>刘备眨着充满问号的大眼睛：“孔明可是说曹贼丞相府小小的主薄司马懿？他有何德何能。。。”<br>诸葛亮慌打断：“亮心有些乱，且不提司马懿那小子。”<br>诸葛亮正襟危坐：“主公，我们要法制不要人制呀！万一哪天亮西去。。。”<br>（刘备止含泪花握住孔明双手，孔明亦紧紧反握住刘备的大手） </p>
<p>半晌，诸葛亮续道：“岂不人亡政息？且主公百年后，阿斗与亮的关系又怎能比得如今亮与主公般相敬如宾？若亮在外争战，阿斗与亮政见不合要亮退兵，决策没有一致性，必将造成大错！如此，我大蜀何以恢复汉室江山呀？！”<br>刘备：“备深感如此。” 诸葛亮：“亮昨夜夜观天象。。。”<br>刘备大喜：“孔明可有良法？”<br>诸葛亮：“。。。亮昨夜夜观天象，竟然睡着，原来近日太耗心力。做一梦，数千年弹指间，亮醒来才觉泪流满面。梦中一帅哥自称陶辉，献上色目人大牛Leslie一法名paxos，或可解我等燃眉之急。”<br>刘备狂喜：“好！”继而搔了搔头：“先请孔明试言我大蜀帝国决策上有哪些问题？”<br>诸葛亮：“喏。” </p>
<h2 id="蜀国现在决策制度的缺陷"><a href="#蜀国现在决策制度的缺陷" class="headerlink" title="蜀国现在决策制度的缺陷"></a>蜀国现在决策制度的缺陷</h2><p>诸葛亮：“主公，当下蜀国所有决策皆来自亮，这有两个问题，<br>一、若亮身体有恙则政令必有耽误。<br>二、随着汉中的收复，我们的地盘越来越大，事务也越来越多，目前亮乃五百年不世出奇才，尚能支撑，可若是将来收复长安，亮一人之力必不堪重负。请问主公有何策解此二难？”<br>刘备沉吟着：“可让法正法孝直，黄权黄公衡为你副手，平日助你共同议政决策，能帮你减负呀。孔明你老习惯在初一十五深入民间依红偎翠，那时他们都可暂时顶替于你，如此也不怕政令耽误了。”<br>诸葛亮咳嗽了下：“此二人皆治世之才！然，若子龙请求黄公衡允许蜀棉私营，而同时主公又请求亮加强垄断这有钱途的行业–禁止蜀棉私营，文武百官令行两出，或听亮的搞国家垄断，或听黄公衡的搞民营经济，百姓何以自处？”<br>刘备沉思半晌，方答道：“我们把决策分为两部分，一种是新增政策，如我正准备加税。另一种是下级官员请求政令的解释，比如马超出征归来时问伤兵抚恤金是多少等等。这样，孔明可处理所有新增决策，法正与黄权只负责解释已有决策。下面官员在执行时，任意找你三人中清闲者，就某个事件询问有何政令可指导，需要增加新的法令时，则只能找孔明你，孔明你决定新法令后，再通知法正和黄权这哥俩，这样法令就同步且一致了。当孔明不在时，由法正顶上这个决策位置；法正不在时，由黄权顶上。如此可好？”<br>诸葛亮惊喜道：“善！这可是master-slave设计呀！” 刘备也睁大了双眼闪着问号。<br>诸葛亮咳嗽了下：“亮昨夜未睡好，失言了。”<br>诸葛亮又说道：“可这样还有问题，日后若我们收复许昌洛阳建业后，那时新法令会更多，只允许一人处理新法令新决策，必然还会忙不过来！而且，人为的指定亮的第二顺拉继承者是法正，黄权为第三顺位，这样也不妥，在地位不平等时，若以后决策组又增加许多新人，或者同一时间多人一起吃酒吃坏肚子，都会非常麻烦。”<br>刘备拍案而起：“孔明你主张大家都是同样地位，没有主次之分？这样无论哪个人出问题了，都不会对蜀国有什么影响？而且多人之间信息共享后，不会因人废事，也不会有人亡政息之事了？”<br>诸葛亮：“Bingo！ 全对！这是真正的分布式！” 刘备大声叫好：“分布式？好名字，和八阵图一样响亮呀！” 诸葛亮：“但这完全平等的分布式决策机制，仍然必须政令统一，不能有不一致的法令，例如黄权认为他昨天中午通过的法令是嚼口香糖者一律杖责十板，免得有人随地乱吐影响市容（好象他们还立法大便后必须冲马桶）。而法正却在昨天上午就接受番邦李光耀的提议，允许嚼外国进口环保口香糖，百姓到底听谁的呢？” 刘备：“我知道孔明你很讨厌威权国家，别老抱怨，新加坡又没碍你事。上面这就是一致性问题了。孔明别卖关子了，快说你的paxos解决方法吧。” </p>
<h1 id="paxos需要解决的分布式问题"><a href="#paxos需要解决的分布式问题" class="headerlink" title="paxos需要解决的分布式问题"></a>paxos需要解决的分布式问题</h1><p>诸葛亮激动道：“paxos可是真正的民主呀，两千年后我们汉人仍然做不到，这不是汉人的劣根性（乌坎村都能办好的），实是历史遗毒呀。闲话少叙，我们先来看看除了能保持一致性，paxos能解决哪些问题吧。<br>一、决策委员会里缺了哪个人都可以，蜀国照常做出决策。<br>二、大家的办公地又不在一起，平时通过信使小吏们传递消息，若信使在路上传消息时被马车撞死，仍然不会有政令不一致。<br>三、若信使被马车撞伤了，医治后迟了几个月才送到某人（例如法正），还不会出现政令不一致。<br>四、若信使被马车撞失忆了，以为刚送过消息的黄权还没送过，又跑去告诉黄权一次，同样不会有不一致出现。” </p>
<p>刘备：“孔明，我知道你马车机关多，开名车也不用总提嘛！若是信使被曹操的间谍收买了也没事吗？”<br>诸葛亮尴尬道：“这个不行，我们还是要相信人性本善嘛。呃，蜀国大部分都是好人。嗯，好吧，我们国安局不是吃干饭的，信使可以丢失、重复传递、延迟，但是我们保证不会被收买的。” 刘备：“好吧，能解决这四个问题也很不错，基本异常都考虑到了。快说说这个paxos解决之道吧。” </p>
<h1 id="paxos的约束条件"><a href="#paxos的约束条件" class="headerlink" title="paxos的约束条件"></a>paxos的约束条件</h1><p>诸葛亮：“刚刚不是说了民主吗？民主是个宝呀，它能解决一切问题。决策者之间不分高下，所以既然想要他们保持一致，我们就要用投票，少数服从多数！”<br>刘备：“怎么个投法？”<br>诸葛亮：“如果主公手下五虎上将是五个决策者。。。”<br>刘备：“那五个肌肉男？”<br>诸葛亮：“正是，这证明即使五个头脑简单的武夫也能做好。”（五虎将齐打喷嚏。） </p>
<p>诸葛亮：“谁提议新政令（提案者），谁就发起投票。我们保证，投票者必须是决策者中的大多数。”<br>刘备：“怎么定大多数呢？”<br>诸葛亮：“任意两次投票中，必须有重合的决策者，这就是大多数了。比如五虎将做决策者，每次政令通过中，必须有三个人或更多投票的人才能决定，这样两次投票中至少有一人都参加了，他就可以拍板！对提案者来说，如果大多数投票者都投赞成这个提议，法令就通过。”<br>刘备沉重地说道：“孔明，万一总是凑不成大多数，岂不是耽误我们的现代化进程？民主，对中国国情来说，太复杂了。” </p>
<p>诸葛亮又激动了：“主公，不复杂的，长远来看好处很明显，不要短视！如果能做到以个三个基本点，所有政令绝对不会出现不一致，而且不会出现无法进行下去的事。一、所有政令必须被提出后才能批准；二、一次提出政令的过程中，只能批准一条政令；三、书记官（负责永久记录政令的官员）只能学习已经批准的政令。只要做到这三点，肯定不会政令不一致！” </p>
<p>刘备：“可是孔明，你在说什么呀？我只想知道决策者该怎么做。” 诸葛亮自信满满：“别急主公，从数学上可以证明，只要满足上面三条，一定不会出现政令不一。当然，这三条太宽泛了，不能对决策者做出指导。我还有更加严格的约束。一、每个决策者必须接受他收到的第一个提议政令。”<br>刘备：“凭什么呀？”诸葛亮：“我们要假定提议者已经搞清楚了一切，肯定是好提案啦。这不是我们的重点，别打断我。” </p>
<p>诸葛亮：“二、一旦关于一件事，我们通过一条法令后，之后关于这件事通过的任何法令，都还得是这个法令。”<br>刘备呆了下：“这不废话吗？”<br>诸葛亮自信满满：“虽然是废话，但你想，保证了这第2条，是不是所有的政令都必须一致呀？”<br>刘备：“可是对决策者没指导意义呀。”<br>诸葛亮自信满满：“是的，所以，我们加强约束，三、如果一条法令批准后，之后每一个决策者如果关于这件事又通过法令，那这个法令还得是同一条。”<br>刘备傻了：“你说得是没错，可这有什么用呢？”<br>诸葛亮自信满满：“所以继续加强约束：四、如果一条法令被批准通过了，之后提议者关于这件事，又提新法令，必须还得是同一个法令。”<br>刘备怒了：“孔明我想揍你了，你说这些有个屁用啊！” </p>
<p>诸葛亮自信满满：“别急主公，现在我要祭出最强约束条件作为我的奥义了：五、每个提案都得有个独一无二的编号，如果编号N的提案通过了，那么大多数决策者们，要么从没接受者编号小于N的任何提议，要么最近一次批准通过的法令就是这个提案。” 刘备开始追打诸葛亮：“孔明你个坏人，你玩我呀！这屁话你对我说！” 诸葛亮边逃边喊：“wiki里就是这么解释的，哎，主公你不懂数学别打我嘛。Leslie的论文也是这么写的。。。” </p>
<h1 id="paxos执行流程"><a href="#paxos执行流程" class="headerlink" title="paxos执行流程"></a>paxos执行流程</h1><p>刘备：“真爽，孔明你手感不错。说点实在的吧，不懂的东西少扯。”<br>诸葛亮：“主公，你不懂数学嘛。好吧，我来说说paxos<a target="_blank" rel="noopener" href="http://lib.csdn.net/base/datastructure" title="算法与数据结构知识库">算法</a>的流程，就三段式，六个步骤而已。角色包括，提案者，决策者，书记官（学习政令的）。 </p>
<p>一、提案者先从主公那里搞到个独一无二的编号，例如N。找到决策者们的多数派，就说五虎将吧，找到三个肌肉男先。假设，这个提案者来自成都，想提的是，外地蜀国将级官员不得无故进入魏国使者驻蜀驿馆。那么，提案者发给三个五虎将，提案中说，我现在有个编号N的提案，关于蜀国高级将领进出魏国使者驿馆的事，请回答我。” </p>
<p>二、五虎将们收到了关于使者驿馆事件的提案，编号是N。其中任一个决策者，比如赵云，他在收到N提案后，首先检查，之前关于魏国使者驿馆事件，有没有收到过提案啊？如果没收到，当然回复提案通过，同时赵云拿出自己的小本本记上，已经回复编号N的提案。如果收到过关于驿馆事件的编号M的提案，就检查编号M，如果M大于N，那么跟信使说，我拒绝这个提案。如果M小于N，回复通过，并且说，关于这事，上次我已经收到了编号M的提案了。 </p>
<p>三、提案者如果收到多数决策者的通过回复，就开始正式提议了。这时，先检查五虎将的回复，如果都简单的回复通过，那么就正式提议之前想提议的《蜀国将级官员不得无故进入魏国使者驻蜀国驿馆》提案。如果决策者们不是简单的回复通过，而是说：这次我赵云通过了，但是我曾经回复过编号M的提案。这样，提案者需要从这次决策者们的回复中，找出所有编号M中的最大值。假设就赵云复杂的回复了，其他四人都是简单的回复通过。那么，提案者这次不能正式提议自己原来想提的，而要提议编号M对应的提案。 </p>
<p>四、同第二步骤一样，五虎将们根据二步骤的准则，选择通过还是不通过。 </p>
<p>五、提案者如果发现多数决策者同意了，意味着法令通过，这时他要记录法令，同时告诉书记官们。 六、书记官们在羊皮纸上记录法令。“ </p>
<h1 id="paxos算法里的各角色该做的事"><a href="#paxos算法里的各角色该做的事" class="headerlink" title="paxos算法里的各角色该做的事"></a>paxos算法里的各角色该做的事</h1><p>刘备搔搔头：“孔明，你再说说提案者，决策者要做的事吧，书记官的很简单，就不用说了。”<br>诸葛亮：“主公，书记官的工作不简单啊，信使会传丢消息的，书记官也会生病的。我们既要在法令通过时主动通知书记官，又要允许书记官在对法令不清楚时过来主动询问。不过，既然主公想多了解提案者和决策者的工作，我就来详细说说。 一、提案者。首先他得从主公那搞来一个独一无二的编号。”<br>刘备：“我很忙的孔明，我是一把手哎。” </p>
<p>诸葛亮有些无奈：“就光给编号也不干呀！那让他们自己维护自己的编号吧，遇到编号相同时，按级别排序，例如按关羽、张飞、赵云、马超、黄忠排序。然后要找到五虎将的多数派，例如关张赵这三人，发自己要决定的事以及编号过去。这是第一步。在第三步时，又到了提案者要做工作了。如果关羽又不响应自己了，那么再发给黄忠问问看。直到有大多数人响应自己。对于响应的处理，有以下情况： </p>
<p>A、这些响应中，如果有人明确拒绝，比如赵云说，关于驿馆事件，我已经批了编号大于N的提案，那么这次提案最好就放弃吧，或者加大自己的编号，重复第一步再提！ </p>
<p>B、张飞说我可以通过，但是之前我批准过驿馆事件编号小于N的提案，内容是允许进入达到政治避难目的。那么，这次提案内容必须变更为张飞之前提交的方案。 </p>
<p>C、所有人都无条件通过。继续正式提交自己的方案。 到第五步，如果多数派批准了，那么方案正式成为法令。提案者要告诉书记官记录哦。” 刘备：“你这么说我就明白了嘛。多简单？先前搞七搞八的说了一大通。” </p>
<p>诸葛亮：“唉，先前的证明嘛。当然，微软还搞了个两段式提交，号称fast paxos，那个雅虎的zookeeper也是的，其实也就对第五步做了优化。主公，不要打我，你不用管我刚才说了什么。我们继续说决策者的工作。 第二步，决策者开始工作了。例如还是说赵云，他在收到N提案后，首先检查，之前关于魏国使者驿馆事件，有没有收到过提案啊？如果没收到，简单的回复提案通过，同时赵云拿出自己的小本本记上，已经回复编号N的提案。赵云同时承诺，以后收到编号小于N的关于驿馆事件的提案，保证不批！如果收到过编号M的提案，检查这上次编号M，如果M大于N，那么跟信使说，我拒绝这个提案。如果M小于N，回复通过，并且说，关于这事，上次我已经收到了编号M的提案了。 第四步决策者批准时也和上面一样。不过fast paxos等两段式的paxos改进算法，在这里决策者们已经可以记录法案了。” </p>
<p>刘备：“好孔明！我有些明白了，不过光说不练假把式，演习下吧。把五个肌肉男叫来，你我来提案，外加捣乱，你可以用你的跑车撞信使了，看看是否出现不一致。” 诸葛亮：“No problem。不过现在我口干舌燥，咱们下回再说吧。”（想从具体的演习，从时间和各种容错上看paxos的效用，敬请期待下篇<a href="/paxos%E7%AE%97%E6%B3%95%E5%A6%82%E4%BD%95%E5%AE%B9%E9%94%99%E7%9A%84-%E8%AE%B2%E8%BF%B0%E4%BA%94%E8%99%8E%E5%B0%86%E7%9A%84%E5%AE%9E%E8%B7%B5/">《paxos算法如何容错的–讲述五虎将的实践》</a> 两人携手扬长而去。</p>

    </div>

    
    
    
      
  <div class="popular-posts-header">相关文章</div>
  <ul class="popular-posts">
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2015\07\27\算法\paxos算法如何容错的-讲述五虎将的实践\" rel="bookmark">paxos算法如何容错的--讲述五虎将的实践</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2018\06\03\算法\解读raft一致性共识算法\" rel="bookmark">分布式环境Raft一致性共识算法解读</a></div>
    </li>
  </ul>

        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>陶辉
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://www.taohui.pub/2015/03/27/%E7%AE%97%E6%B3%95/paxos%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%80%E8%87%B4%E6%80%A7%E7%AE%97%E6%B3%95-%E8%AE%B2%E8%BF%B0%E8%AF%B8%E8%91%9B%E4%BA%AE%E7%9A%84%E5%8F%8D%E7%A9%BF%E8%B6%8A/" title="paxos分布式一致性算法--讲述诸葛亮的反穿越">https://www.taohui.pub/2015/03/27/算法/paxos分布式一致性算法-讲述诸葛亮的反穿越/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/zh-CN" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-ND</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/paxos/" rel="tag"># paxos</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2015/01/27/%E7%AE%97%E6%B3%95/linux%E5%86%85%E6%A0%B8%E8%B0%83%E5%BA%A6%E7%AE%97%E6%B3%95%EF%BC%883%EF%BC%89-%E5%A4%9A%E6%A0%B8%E7%B3%BB%E7%BB%9F%E7%9A%84%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/" rel="prev" title="linux内核调度算法（3）--多核系统的负载均衡">
      <i class="fa fa-chevron-left"></i> linux内核调度算法（3）--多核系统的负载均衡
    </a></div>
      <div class="post-nav-item">
    <a href="/2015/07/27/%E7%AE%97%E6%B3%95/paxos%E7%AE%97%E6%B3%95%E5%A6%82%E4%BD%95%E5%AE%B9%E9%94%99%E7%9A%84-%E8%AE%B2%E8%BF%B0%E4%BA%94%E8%99%8E%E5%B0%86%E7%9A%84%E5%AE%9E%E8%B7%B5/" rel="next" title="paxos算法如何容错的--讲述五虎将的实践">
      paxos算法如何容错的--讲述五虎将的实践 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="gitalk-container"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%BC%95%E5%AD%90"><span class="nav-number">1.</span> <span class="nav-text">引子</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%9C%80%E5%9B%BD%E7%8E%B0%E5%9C%A8%E5%86%B3%E7%AD%96%E5%88%B6%E5%BA%A6%E7%9A%84%E7%BC%BA%E9%99%B7"><span class="nav-number">1.1.</span> <span class="nav-text">蜀国现在决策制度的缺陷</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#paxos%E9%9C%80%E8%A6%81%E8%A7%A3%E5%86%B3%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F%E9%97%AE%E9%A2%98"><span class="nav-number">2.</span> <span class="nav-text">paxos需要解决的分布式问题</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#paxos%E7%9A%84%E7%BA%A6%E6%9D%9F%E6%9D%A1%E4%BB%B6"><span class="nav-number">3.</span> <span class="nav-text">paxos的约束条件</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#paxos%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B"><span class="nav-number">4.</span> <span class="nav-text">paxos执行流程</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#paxos%E7%AE%97%E6%B3%95%E9%87%8C%E7%9A%84%E5%90%84%E8%A7%92%E8%89%B2%E8%AF%A5%E5%81%9A%E7%9A%84%E4%BA%8B"><span class="nav-number">5.</span> <span class="nav-text">paxos算法里的各角色该做的事</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <a href="/关于陶辉/index.html"><img class="site-author-image" itemprop="image" alt="陶辉"
      src="/images/taohui_avatar.JPG"></a>
  <p class="site-author-name" itemprop="name">陶辉</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">78</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">314</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/russelltao" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;russelltao" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:russelltao@foxmail.com" title="邮件 → mailto:russelltao@foxmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>邮件</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/russelltao" title="微博 → https:&#x2F;&#x2F;weibo.com&#x2F;russelltao" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i>微博</a>
      </span>
  </div>



  <div class="links-of-recent-posts motion-element">
    <div class="links-of-recent-posts-title">
      <i class="fa fa-history fa-fw"></i>
      最近文章
    </div>
    <ul class="links-of-recent-posts-list">
        <li class="links-of-recent-posts-item">
          <a href="/2024/09/05/nginx/GoAccess-%E5%AE%9E%E6%97%B6%E5%88%86%E6%9E%90Nginx%E6%97%A5%E5%BF%97%E7%9A%84%E8%BD%BB%E9%87%8F%E7%BA%A7%E5%B7%A5%E5%85%B7/" title="2024&#x2F;09&#x2F;05&#x2F;nginx&#x2F;GoAccess-实时分析Nginx日志的轻量级工具&#x2F;">GoAccess: 实时分析Nginx日志的轻量级工具</a>
        </li>
        <li class="links-of-recent-posts-item">
          <a href="/2024/08/01/%E5%88%86%E5%B8%83%E5%BC%8F%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/%E6%9E%84%E5%BB%BA%E5%BC%B9%E6%80%A7%E7%BD%91%E7%BB%9C%E4%B9%8B%E5%88%86%E5%B8%83%E5%BC%8F%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E6%8A%80%E6%9C%AF%EF%BC%88%E4%BA%8C%EF%BC%89%EF%BC%9A%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E7%8E%B0/" title="2024&#x2F;08&#x2F;01&#x2F;分布式负载均衡&#x2F;构建弹性网络之分布式负载均衡技术（二）：技术与实现&#x2F;">构建弹性网络之分布式负载均衡技术（二）：技术与实现</a>
        </li>
        <li class="links-of-recent-posts-item">
          <a href="/2024/07/18/%E5%88%86%E5%B8%83%E5%BC%8F%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/%E6%9E%84%E5%BB%BA%E5%BC%B9%E6%80%A7%E7%BD%91%E7%BB%9C%E4%B9%8B%E5%88%86%E5%B8%83%E5%BC%8F%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E6%8A%80%E6%9C%AF-%E4%B8%80-%EF%BC%9A%E7%89%B9%E7%82%B9%E4%B8%8E%E5%8A%9F%E8%83%BD/" title="2024&#x2F;07&#x2F;18&#x2F;分布式负载均衡&#x2F;构建弹性网络之分布式负载均衡技术-一-：特点与功能&#x2F;">构建弹性网络之分布式负载均衡技术(一)：特点与功能</a>
        </li>
        <li class="links-of-recent-posts-item">
          <a href="/2024/06/11/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/%E7%99%BE%E4%B8%87%E5%B9%B6%E5%8F%91%E8%BF%9E%E6%8E%A5%E6%8C%91%E6%88%98%EF%BC%9Awrk%E7%9A%84%E9%AB%98%E5%B9%B6%E5%8F%91%E6%B5%8B%E8%AF%95%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90/" title="2024&#x2F;06&#x2F;11&#x2F;网络协议&#x2F;百万并发连接挑战：wrk的高并发测试深度解析&#x2F;">百万并发连接挑战：wrk的高并发测试深度解析</a>
        </li>
        <li class="links-of-recent-posts-item">
          <a href="/2023/09/13/nginx/Nginx%E9%99%90%E9%80%9F%E6%8A%80%E6%9C%AF%E8%A7%A3%E6%9E%90%EF%BC%9A%E4%BB%8E%E5%AD%97%E8%8A%82%E5%88%B0%E8%AF%B7%E6%B1%82%E7%9A%84%E7%B2%BE%E7%A1%AE%E6%8E%A7%E5%88%B6/" title="2023&#x2F;09&#x2F;13&#x2F;nginx&#x2F;Nginx限速技术解析：从字节到请求的精确控制&#x2F;">Nginx的字节级限速原理</a>
        </li>
    </ul>
  </div>
      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        
  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank"><a target="_blank" rel="noopener" href="https://beian.miit.gov.cn">浙ICP备14005132号-1</a> </a>
      <img src="/images/%E5%A4%87%E6%A1%88%E5%9B%BE%E6%A0%87.png" style="display: inline-block;"><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=33010802009076" rel="noopener" target="_blank">浙公网安备 33010802009076号 </a>
  </div>

<div class="copyright">
  
  &copy; 2013 – 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">陶辉</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    <span title="站点总字数">373k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">5:39</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script size="300" alpha="0.6" zIndex="-1" src="//fastly.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-ribbon.min.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>

<script src="/js/bookmark.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css">

<script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID    : 'Ov23liqLrOhytbzoKLIE',
      clientSecret: 'f41a4c64f001be23ee45cd15af1ba91acdfbf72f',
      repo        : 'myblog_comments',
      owner       : 'russelltao',
      admin       : ['russelltao'],
      id          : '934a5fc46a52ec12b706e4c9daee9da7',
        language: 'zh-CN',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script>

</body>
</html>
